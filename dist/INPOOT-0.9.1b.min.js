/*! INPOOT - v0.9.1b - 2012-07-25
* http://johndavidfive.com/inpoot
* Copyright (c) 2012 John David Martin; Licensed MIT */
var inpoot={};(function(a){var b=function(a,b){return a.indexOf(b)!=-1},c=navigator.userAgent,d=b(c,"Windows NT"),e=b(c,"Macintosh"),f=b(c,"Chrome/"),g=b(c,"Firefox/"),h={};if(g){navigator.mozGamepads=[];var i=function(a){navigator.mozGamepads[a.gamepad.index]=a.gamepad},k=function(a){navigator.mozGamepads[a.gamepad.index]=undefined};window.addEventListener("MozGamepadConnected",i),window.addEventListener("MozGamepadDisconnected",k)}var l=function(a){for(var c in inpoot.gamepads){var d=inpoot.gamepads[c],e=d.idMatches;for(var f=0;f<e.length;f++){var g=e[f],h=!0;for(var i=0;i<g.length;i++)b(a.id,g[i])||(h=!1);if(h){a.displayName=d.displayName,a.gpadType=c;return}}}a.gpadType=a.id,a.displayName="Unknown gamepad"},m={},n={},o={},p={},q={},r=!1,s=0,t=!1,u=!1,v=1,w,x={mouse:{},keyboard:{},gamepad:{}},y={},z=function(a){h[a.keyCode]=1},A=function(a){h[a.keyCode]=0},B={1:"mouse_button_left",2:"mouse_button_middle",3:"mouse_button_right"},C=function(a){x.mouse[B[a.which]]=1},D=function(a){x.mouse[B[a.which]]=0},E=function(a){s=0;var b=a.movementX||a.mozMovementX||a.webkitMovementX||0,c=a.movementY||a.mozMovementY||a.webkitMovementY||0;b||c?(x.mouse.mouseDX=b,x.mouse.mouseDY=c):(x.mouse.mouseXL=x.mouse.mouseX,x.mouse.mouseYL=x.mouse.mouseY,x.mouse.mouseX=a.clientX/window.innerWidth*2-1,x.mouse.mouseY=a.clientY/window.innerHeight*2-1,x.mouse.mouseDX=x.mouse.mouseX-x.mouse.mouseXL,x.mouse.mouseDY=x.mouse.mouseY-x.mouse.mouseYL)},F=function(){return navigator.webkitGamepads||navigator.mozGamepads||navigator.gamepads},G=function(){var a=[],b=F(),c=0;for(var d in b)b[d]!=undefined&&d!="length"&&b.hasOwnProperty(d)&&(c++,l(b[d]),a.push({player:c,gamepad:b[d],gamepadIndex:d}),x.gamepad[d]||(x.gamepad[d]={type:b[d].gpadType,values:{}}));return a};inpoot.initialize=function(b){document.onkeydown=z,document.onkeyup=A,document.onmousemove=E,document.onmousedown=C,document.onmouseup=D,m=G(),n=b.actions,v=b.maxPlayers||1,w=b.mouseNormalizer||3,o=a.storage.getObject("gamepadmaps")||{},b.mappings&&a.storage.getObject("inpoot_action_mappings")===null&&inpoot.setMappings(b.mappings),b.players&&a.storage.getObject("inpoot_stored_players")===null&&inpoot.setPlayers(b.players)};var H=function(){o=a.storage.getObject("gamepadmaps")||{}},I=function(a,b,c){return o[a].rawToButton[b][c]},J=function(a,b,c){var d=V(a);return d[b][c].name||c},K=function(a,b,c){var d=o[a].rawToButton.axesMap[b];if(!d){var e=J(a,"button",b),f=o[a].rawToButton.buttons[b];return{text:e,value:b,buttonType:"button",subType:""}}var e=J(a,"axis_dual",d.bid),g=d.subType=="y"?c<=0?"down":"up":c>0?"right":"left";return{text:e+" "+d.direction,value:d.bid,buttonType:"axis_dual",subType:d.subType,direction:d.direction}},L=0,M=!1;inpoot.refreshParams=function(){M=!0};var N=.35;inpoot.setThreshold=function(a){N=a},inpoot.tick=function(b){if(r&&!b)return;s++,s>1&&(x.mouse.mouseDX=0,x.mouse.mouseDY=0),y=a.extend(!0,{},x),x.keyboard=a.extend(!0,{},h),L==0&&(m=G(),S()),L=(L+1)%1e3,M&&(L=0,M=!1);var c=F();for(var d=0;d<m.length;d++){var e=m[d],f=c[e.gamepadIndex];if(f&&f.gpadType){for(var g=0;g<f.buttons.length;g++)try{x.gamepad[e.gamepadIndex].values[I(f.gpadType,"buttons",g).bid]=f.buttons[g]}catch(i){}for(var g=0;g<f.axes.length;g++){var j=I(f.gpadType,"axes",g),k=Math.abs(f.axes[g]),l=k>N?k:0;j.subType=="x"?f.axes[g]<=0?(x.gamepad[e.gamepadIndex].values[j.bid+"left"]=l,x.gamepad[e.gamepadIndex].values[j.bid+"right"]=0):(x.gamepad[e.gamepadIndex].values[j.bid+"left"]=0,x.gamepad[e.gamepadIndex].values[j.bid+"right"]=l):f.axes[g]<=0?(x.gamepad[e.gamepadIndex].values[j.bid+"up"]=l,x.gamepad[e.gamepadIndex].values[j.bid+"down"]=0):(x.gamepad[e.gamepadIndex].values[j.bid+"up"]=0,x.gamepad[e.gamepadIndex].values[j.bid+"down"]=l)}}}return x};var O=0,P={},Q={},R={},S=function(){P={};var b=a.storage.getObject("inpoot_stored_players");for(playa in b){var c=b[playa];P[c.number]={actionMapId:c.actionMapId,gamepad:c.gamepad,gamepadIndex:c.options.gpadIndex,invert:c.options.axes}}Q=a.storage.getObject("inpoot_action_mappings");for(var d=0;d<Q.length;d++)R[Q[d].id]=d};inpoot.action=function(a,b,c){c=c||{},b=b||1;var d={pressed:0,delta:0,val:0},e=P[b],f,g,h;if(e&&Q[R[e.actionMapId]]&&(f=Q[R[e.actionMapId]].mapping[a])){var i=f.inputs||[];for(var j=0;j<i.length;j++)for(var k=0;k<i[j].inputs.length;k++)i[j].inputs[k].type=="keyboard"?(x.keyboard[i[j].inputs[k].value]===undefined&&(x.keyboard[i[j].inputs[k].value]=0),g=x.keyboard[i[j].inputs[k].value],h=y.keyboard[i[j].inputs[k].value],d.val=g,d.pressed=!g&&h,d.delta=g-h,d.pressed&&c.clear&&(x.keyboard[i[j].inputs[k].value]=0,y.keyboard[i[j].inputs[k].value]=0)):i[j].inputs[k].type=="gamepad"?x.gamepad[e.gamepadIndex]!==!1&&x.gamepad[e.gamepadIndex]!==undefined&&(i[j].inputs[k].buttonType=="axis_dual"?(e.invert&&e.invert[i[j].inputs[k].value]&&(i[j].inputs[k].direction=="up"||i[j].inputs[k].direction=="down")?i[j].inputs[k].direction=="up"?(g=x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+"down"],h=y.gamepad[e.gamepadIndex]?y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+"down"]:0):(g=x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+"up"],h=y.gamepad[e.gamepadIndex]?y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+"up"]:0):(g=x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+i[j].inputs[k].direction],h=y.gamepad[e.gamepadIndex]?y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+i[j].inputs[k].direction]:0),d.val=g,d.pressed=!g&&h,d.delta=g-h,d.pressed&&c.clear&&(x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+i[j].inputs[k].direction]=0,y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value+i[j].inputs[k].direction]=0)):(g=x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value],h=y.gamepad[e.gamepadIndex]?y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value]:0,d.val=g,d.pressed=!g&&h,d.delta=g-h,d.pressed&&c.clear&&(x.gamepad[e.gamepadIndex].values[i[j].inputs[k].value]=0,y.gamepad[e.gamepadIndex].values[i[j].inputs[k].value]=0))):i[j].inputs[k].type=="mouse"&&(i[j].inputs[k].value=="mouse_up"?(g=x.mouse.mouseDY<0?Math.min(Math.abs(x.mouse.mouseDY)/w,1):0,h=y.mouse.mouseDY<0?Math.min(Math.abs(x.mouse.mouseDY)/w,1):0):i[j].inputs[k].value=="mouse_down"?(g=x.mouse.mouseDY>=0?Math.min(x.mouse.mouseDY/w,1):0,h=y.mouse.mouseDY>=0?Math.min(x.mouse.mouseDY/w,1):0):i[j].inputs[k].value=="mouse_left"?(g=x.mouse.mouseDX<0?Math.min(Math.abs(x.mouse.mouseDX)/w,1):0,h=y.mouse.mouseDX<0?Math.min(Math.abs(x.mouse.mouseDX)/w,1):0):i[j].inputs[k].value=="mouse_right"?(g=x.mouse.mouseDX>=0?Math.min(x.mouse.mouseDX/w,1):0,h=y.mouse.mouseDX>=0?Math.min(x.mouse.mouseDX/w,1):0):(g=x.mouse[i[j].inputs[k].value],h=y.mouse[i[j].inputs[k].value]),d.val=g,d.pressed=!g&&h,d.delta=g-h)}return d.val||(d.val=0),d.pressed||(d.pressed=0),d.delta||(d.delta=0),d},inpoot.resetConfigs=function(){t&&inpoot.setPlayers(t),u&&inpoot.setMappings(u)},inpoot.getMappings=function(){var b=a.storage.getObject("inpoot_action_mappings");return JSON.stringify(b)},inpoot.setMappings=function(b){typeof b=="string"&&(b=JSON.parse(b)),u=b,a.storage.setObject("inpoot_action_mappings",b)},inpoot.getPlayers=function(){var b=a.storage.getObject("inpoot_stored_players");return JSON.stringify(b)},inpoot.setPlayers=function(b){typeof b=="string"&&(b=JSON.parse(b)),t=b,a.storage.setObject("inpoot_stored_players",b)},inpoot.getRemoteGamepadConfigs=function(){};var T=function(a){var b=inpoot.gamepads[a],c={buttonToRaw:{button:{},axis:{},axis_dual:{}},rawToButton:{buttons:{},axes:{},axesMap:{}}};if(!b){alert("We do not have configurations stored for this type of gamepad:"+a);return}for(var d in b.button)c.buttonToRaw.button[d]=!1;for(var e in b.axis_dual)c.buttonToRaw.axis_dual[e]={x:!1,y:!1};return c},U=function(b){var c=o[b];return c?c:(c=T(b),c?(o[b]=c,a.storage.setObject("gamepadmaps",o),c):!1)},V=function(a){return inpoot.gamepads[a]},W=function(){a.storage.setObject("gamepadmaps",o)},X=function(){var b=function(b){var c=a(b.nodes[0]);c.find(".inpoot-main-option.players").click(function(){be()}),c.find(".inpoot-main-option.settings").click(function(){bd()}),c.find(".inpoot-main-option.mappings").click(function(){bb()})};inpoot.utils.modal.show({template:"inpoot.main-content",data:{},behavior:b})},Y=function(){var a=Z(),b=-1;for(var c=0;c<a.length;c++)b<a[c].id&&(b=a[c].id);return b+1},Z=function(b){var c=a.storage.getObject("inpoot_action_mappings");c||(c=[],a.storage.setObject("inpoot_action_mappings",c));if(b===undefined||b===null)return c;for(var d=0;d<c.length;d++)if(c[d].id==b)return c[d]},$=function(b){var c=Z();for(var d=0;d<c.length;d++)c[d].id==b&&(c.splice(d,1),a.storage.setObject("inpoot_action_mappings",c))},_=function(){var b=a.extend({},n);return b},ba=function(b){H();var c=Z(b),d=a.storage.getObject("storedGamepads")||[],e=function(){var d=Z();for(var e=0;e<d.length;e++)d[e].id==b&&(d[e]=c,a.storage.setObject("inpoot_action_mappings",d))},f=function(b){var c=a(b.nodes[0]),f=b.data.actionMap;c.find(".inpoot-top-option").click(bb),c.find(".inpoot-main-gamepad-options-message input").inpootEdit({onChange:function(a){f.name=a,e()},defaultText:"New Mapping"});var g=[{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the gamepad"}];for(var h=0;h<d.length;h++)g.push({text:d[h].displayName,value:d[h].gpadType,style:"on",message:"Switching gamepads will remove all mappings from other gamepads",ifNot:["false"]});inpoot.utils.styledSelect({container:a(".inpoot-input-selector.keyboard"),selected:f.keyboard,options:[{text:"ON",value:"true",style:"on"},{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the keyboard"}],callBack:function(a){f.keyboard=a.value,e()}}),inpoot.utils.styledSelect({container:a(".inpoot-input-selector.mouse"),selected:f.mouse,options:[{text:"ON",value:"true",style:"on"},{text:"OFF",value:"false",style:"off",message:"Warning, this will remove all mappings that currently use the mouse"}],callBack:function(a){f.mouse=a.value,e()}}),inpoot.utils.styledSelect({container:a(".inpoot-input-selector.gamepad"),selected:f.gamepad,options:g,callBack:function(a){f.gamepad=a.value,e()}});var i=function(a){var b=-1;for(var c=0;c<a.length;c++)b<a[c].id&&(b=a[c].id);return b+1},j=function(a,b,c){var d=f.mapping[a].inputs,g=-1;for(var h=0;h<d.length;h++)if(d[h].id==b){g=h;break}g!=-1&&(d.splice(g,1),e(),c())},k=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c]},l=function(b){var c=a(b.nodes[0])},m=function(b){a.tmpl("inpoot.action_map.action_list_mappings",f,{rendered:l}).appendTo(a(".inpoot-map-form-right-inner").html(""))},l=function(b){var c=a(b.nodes[0])},n=function(b){var c=a(b.nodes[0]),d=b.data,g=c.find(".inpoot-edit-mapping-gather-inputs.gamepad"),h=g.find(".inpoot-edit-mapping-gather-input-list"),i=c.find(".inpoot-edit-mapping-gather-inputs.keyboard"),j=i.find(".inpoot-edit-mapping-gather-input-list"),l=c.find(".inpoot-edit-mapping-gather-inputs.mouse"),m=l.find(".inpoot-edit-mapping-gather-input-list"),n=d.actionMap,o=d.actionId;a(".inpoot-map-form").addClass("editing"),a(".inpoot-editing-inputs-close").unbind("click").click(function(){a(".inpoot-map-form").removeClass("editing"),q(d.actionId)});var p=function(a,b){var c=f.mapping[o].inputs,g=d.mapId,h=-1;for(var i=0;i<c.length;i++)if(c[i].id==g){h=i;break}if(h!=-1){var j=c[h];for(var k=0;k<j.inputs.length;k++)j.inputs[k].type==a&&j.inputs[k].value==b.value&&(j.inputs.splice(k,1),e())}},r=function(b,c){var d=b=="gamepad"?h:b=="mouse"?m:j,e=function(d){var e=a(d.nodes[0]);e.find(".inpoot-x-out").click(function(){p(b,c),e.fadeOut(function(){e.remove()})})};a.tmpl("inpoot.action_map.action_edit_action_map_item",{name:c.text},{rendered:e}).appendTo(d)},s=function(a,b,c){console.log("adding",a,b,c);var f=n.id;inputIndex=d.mapId;var g=k(n.mapping[o].inputs,inputIndex);g.inputs.push({type:a,text:b.text,value:b.value,buttonType:b.buttonType,subType:b.subType,direction:b.direction}),console.log("adding:",b.direction,b),e(),r(a,b)},t={keyboard:{},gamepad:{}},u={},v=d.actionMap.gamepad,w=function(){for(gpad in x.gamepad){var b=x.gamepad[gpad];if(b.type==v)for(padKey in b.values)b.values[padKey]?t.gamepad[padKey]=b.values[padKey]:t.gamepad[padKey]=0}for(key in t.gamepad)Math.abs(t.gamepad[key])<=.5&&u.gamepad&&Math.abs(u.gamepad[key])>.5&&s("gamepad",K(v,key,u.gamepad[key]));u=a.extend(!0,{},t);if(n.keyboard&&n.keyboard!="false"){for(key in t.keyboard)t.keyboard[key]==!0&&!x.keyboard[key]&&(s("keyboard",{text:inpoot.getKeyboardMap(key),value:key}),delete t.keyboard[key]);for(key in x.keyboard)x.keyboard[key]&&(t.keyboard[key]=!0)}},y=k(n.mapping[o].inputs,d.mapId),z=y.inputs;for(var A=0;A<z.length;A++)r(z[A].type,z[A]);if(n.mouse&&n.mouse!="false"){var B=a(".dumbBox-content");l.find(".inpoot-gather-add-button").click(function(){var a=[{text:"mouse up",value:"mouse_up"},{text:"mouse down",value:"mouse_down"},{text:"mouse left",value:"mouse_left"},{text:"mouse right",value:"mouse_right"},{text:"left button",value:"mouse_button_left"},{text:"middle button",value:"mouse_button_middle"},{text:"right button",value:"mouse_button_right"},{text:"back button",value:"mouse_button_back"},{text:"forward button",value:"mouse_button_forward"},{text:"scroll forward",value:"mouse_scroll_forward"},{text:"scroll back",value:"mouse_scroll_back"}],b=inpoot.utils.optionBox({title:undefined,container:B,options:a,maxHeight:400,callBack:function(a){s("mouse",a)}})})}if(n.gamepad&&n.gamepad!="false"){var C=V(n.gamepad),D=[],E=function(a,b,c){D.push({text:a,value:b,data:c})},F=function(a,b){return b[a].name?b[a].name:a};for(var G in C.button)E(F(G,C.button),G,{subType:"button"});for(var H in C.axis_dual)E(F(H,C.axis_dual)+" up",H,{buttonType:"axis_dual",subType:"y",direction:"up"}),E(F(H,C.axis_dual)+" down",H,{buttonType:"axis_dual",subType:"y",direction:"down"}),E(F(H,C.axis_dual)+" left",H,{buttonType:"axis_dual",subType:"x",direction:"left"}),E(F(H,C.axis_dual)+" right",H,{buttonType:"axis_dual",subType:"x",direction:"right"});var B=a(".dumbBox-content");g.find(".inpoot-gather-add-button").click(function(){var a=inpoot.utils.optionBox({title:undefined,container:B,options:D,maxHeight:400,callBack:function(a){s("gamepad",{value:a.value,text:a.text,subType:a.data.subType,buttonType:a.data.buttonType,direction:a.data.direction})}})})}inpoot.utils.poll.setInterval(function(){inpoot.tick(!0),w()},100,"live-mapping")},o=function(b,c){var d=f.mapping[b].inputs,e=k(d,c),g=a(".inpoot-map-form-left-hidden-inner"),h=f.mapping[b].descr?f.mapping[b].descr:b;g.find(".inpoot-editing-inputs-title").html(h);var i=0;f.keyboard&&f.keyboard!="false"&&i++,f.mouse&&f.mouse!="false"&&i++,f.gamepad&&f.gamepad!="false"&&i++,a.tmpl("inpoot.action_map.action_edit_mapping",{actionMap:f,actionId:b,mapId:c,inputCount:i},{rendered:n}).appendTo(a(".inpoot-map-form-right-inner").html(""))},p,q=function(b){inpoot.utils.poll.clear("live-mapping");var c=f.mapping[b],d=function(c){var d=a(c.nodes[0]),g=c.data,h=function(){f.mapping[b].inputs=f.mapping[b].inputs||[];var c=f.mapping[b].inputs,g=i(c);c.push({id:g,inputs:[]}),e(),a.tmpl("inpoot.action_map.action_edit_action_input_hidden",[{id:g,inputs:[]}],{rendered:k}).appendTo(d.find(".inpoot-main-gamepad-edit-action-options-list"))},k=function(c){var d=a(c.nodes[0]),e=c.data;d.click(function(){o(b,e.id)}),d.find(".inpoot-x-out").click(function(a){a.preventDefault(),a.stopPropagation(),j(b,e.id,function(){d.fadeOut("fast",function(){d.remove()})})}),d.fadeIn("fast")};d.find(".inpoot-main-gamepad-edit-action-options").click(h),a.tmpl("inpoot.action_map.action_edit_action_input",g.inputs||[],{rendered:k}).appendTo(d.find(".inpoot-main-gamepad-edit-action-options-list").html(""))},g={actionId:b,descr:c.descr,inputs:c.inputs};a.tmpl("inpoot.action_map.action_edit_action_inputs",g,{rendered:d}).appendTo(a(".inpoot-map-form-right-inner").html(""))},r=function(b,c){p=b;var d=function(b){var c=a(b.nodes[0]),d=b.data;c.click(function(){a(".inpoot-edit-action-map-list-group-action").removeClass("selected"),c.addClass("selected"),q(d.actionId)})};a.tmpl("inpoot.action_map.action_list_item",c,{rendered:d}).appendTo(a(".inpoot-map-form-middle-inner").html("")),a(".inpoot-edit-action-map-list-group-action").length>0&&a(a(".inpoot-edit-action-map-list-group-action")[0]).click()},s=function(b){var c=a(b.nodes[0]),d=b.data;c.click(function(){a(".inpoot-edit-action-map-list-group").removeClass("selected"),c.addClass("selected"),r(d.name,d.actions)})},t=function(a){var b={},c=[],d=function(a,d,e){c[b[a]].actions.push({actionId:d,category:a,descr:e.descr||d,inputs:e.inputs})};for(var e in a){var f=a[e];f.category?(b[f.category]==undefined&&(b[f.category]=c.length,c.push({actions:[],name:f.category})),d(f.category,e,f)):(b.other==undefined&&(b.other=c.length,c.push({actions:[],name:"other"})),d("other",e,f))}return c};a.tmpl("inpoot.action_map.action_list",t(f.mapping),{rendered:s}).appendTo(a(".inpoot-map-form-left-inner")),a(".inpoot-edit-action-map-list-group").length>0&&a(a(".inpoot-edit-action-map-list-group")[0]).click()};c.extra=="click to edit"&&(c.extra="",e()),inpoot.utils.modal.show({template:"inpoot.action_map",data:{actionMap:c,gamepads:d},behavior:f})},bb=function(){var b=function(){var b=Z(),c={name:"New Mapping",extra:"click to edit",gamepad:!1,keyboard:!0,mouse:!0,id:Y(),mapping:_()};b.push(c),a.storage.setObject("inpoot_action_mappings",b)},c=function(){var b=a(".inpoot-mappings-list"),c=function(b){var c=a(b.nodes[0]);c.find(".inpoot-mapping-item-delete").click(function(a){a.preventDefault(),a.stopPropagation(),c.find(".inpoot-mapping-item-inputs").stop(!0,!0).hide(),c.find(".inpoot-mapping-item-delete-confirm").stop(!0,!0).fadeIn("fast")}),c.find(".inpoot-mapping-item-delete-confirm-cancel").click(function(a){a.preventDefault(),a.stopPropagation(),c.find(".inpoot-mapping-item-delete-confirm").stop(!0,!0).hide(),c.find(".inpoot-mapping-item-inputs").stop(!0,!0).fadeIn("fast")}),c.find(".inpoot-mapping-item-delete-confirm-okay").click(function(a){a.preventDefault(),a.stopPropagation(),c.slideUp(function(){c.remove(),$(b.data.id),inpoot.utils.modal.expand()})}),c.click(function(){ba(b.data.id)})},d=Z();b.html(""),a.tmpl("inpoot.mapping-list",d,{rendered:c}).appendTo(b),inpoot.utils.modal.expand()},d=function(d){var e=a(d.nodes[0]);e.find(".inpoot-top-option").click(X),e.find(".inpoot-message-button").click(function(){b(),c()}),c()};inpoot.utils.modal.show({template:"inpoot.mappings",data:{},behavior:d})},bc=function(b){var c,d,e,f=function(b){d=b,e=0,inpoot.utils.poll.clear("monitor-callibration"),a(".pressed-now").remove("pressed-now"),h()},g=function(){inpoot.utils.poll.clear("please-stop"),inpoot.utils.poll.clear("single-button-press"),inpoot.utils.poll.clear("continue-monitoring"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).hide(),a(".gamepad-button").removeClass("mapped").removeClass("mapping").removeClass("up").removeClass("down").removeClass("right").removeClass("left"),i=!1,d=[],e=0},h=function(){if(e<d.length){var c=d[e],f=inpoot.gamepads[b.gpadType],g=f[c.type][c.bid],l=g.name||c.bid,m=c.text||"",n=c.style||" ";a(".gamepadclass-"+c.bid).addClass("mapping "+n),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").removeClass("thanks").find(".inpoot-gamepad-calibrate-gamepad-3d-presskey-text").html("PRESS <span class='inpoot-gamepad-presskey-bold'> "+l+" "+m+" </span>"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).show(),j(function(d){var f=U(b.gpadType);c.type=="button"?f.buttonToRaw[d.type][c.bid]=d.number:c.type=="axis_dual"&&(c.style=="up"||c.style=="down"?(f.buttonToRaw.axis_dual[c.bid].y=d.number,f.rawToButton.axesMap[c.bid+"down"]={bid:c.bid,index:d.number,subType:"y",direction:"down"},f.rawToButton.axesMap[c.bid+"up"]={bid:c.bid,index:d.number,subType:"y",direction:"up"}):(f.buttonToRaw.axis_dual[c.bid].x=d.number,f.rawToButton.axesMap[c.bid+"left"]={bid:c.bid,index:d.number,subType:"x",direction:"left"},f.rawToButton.axesMap[c.bid+"right"]={bid:c.bid,index:d.number,subType:"x",direction:"right"}));var g=!1,j=d.type=="button"?"buttons":"axes";if(c.style=="up"||c.style=="down")g="y";else if(c.style=="left"||c.style=="right")g="x";f.rawToButton[j][d.number]={type:c.type,bid:c.bid,subType:g},W(),a(".gamepadclass-"+c.bid).addClass("mapped"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").addClass("thanks"),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").stop(!0,!0).fadeOut(500,function(){a(".gamepadclass-"+c.bid).removeClass("mapped").removeClass("mapping").removeClass(n),e++,inpoot.utils.poll.setTimeout(function(){i=!1,h()},300,"please-stop")})})}else a(".inpoot-gamepad-calibrate-gamepad-3d-presskey").removeClass("thanks").stop(!0,!0).hide(),k()},i=!1,j=function(a){var c=G(),d=[];for(var e=0;e<c.length;e++)c[e].gamepad.gpadType==b.gpadType&&d.push(c[e]);inpoot.utils.poll.setInterval(function(){var b=F();for(var c=0;c<d.length;c++){var e=d[c],f=b[e.gamepadIndex];if(f){for(var g=0;g<f.buttons.length;g++)f.buttons[g]>.5&&!i&&(i=!0,inpoot.utils.poll.clear("single-button-press"),a({type:"button",number:g,value:f.buttons[g]}));for(var g=0;g<f.axes.length;g++)Math.abs(f.axes[g])>.7&&!i&&(i=!0,inpoot.utils.poll.clear("single-button-press"),a({type:"axis",number:g,value:f.axes[g]}))}}},50,"single-button-press")},k=function(){var c=U(b.gpadType),d=inpoot.gamepads[b.gpadType];if(!c)return;var e=function(){inpoot.utils.poll.setTimeout(function(){i=!1,f()},100,"continue-monitoring")},f=function(){j(function(b){console.log(b),a(".pressed").removeClass("pressed");var d=b.type=="button"?"buttons":"axes",f=c.rawToButton[d][b.number];f===undefined&&console.log(c.rawToButton,c.rawToButton[d],d,b.number);var g=" ";f&&f.subType&&(f.subType=="y"?g=b.value>0?"down":"up":f.subType=="x"&&(g=b.value>0?"right":"left")),a(".gamepad-button.gamepadclass-"+f.bid).addClass("pressed "+g),inpoot.utils.poll.setTimeout(function(){a(".gamepad-button.gamepadclass-"+f.bid).removeClass("pressed").removeClass(g)},350),e()})};f()},l=function(d){var e=inpoot.gamepads[b.gpadType],h=G(),i;for(var j=0;j<h.length;j++)if(h[j].gamepad.gpadType==b.gpadType){i=h[j];continue}inpoot.utils.poll.setTimeout(function(){var b=a(d.nodes[0]);c=b,b.find(".inpoot-top-option").click(function(){bd()});for(var f in e.button){var g=e.button[f],h=g.face||"front";a(".inpoot-gamepad-calibrate-face."+h).append('<span class="gamepad-button gamepadclass-'+f+" "+(g.style||"")+" "+(g.bclass||"")+' " style="left:'+g.x+"%; top:"+g.y+'%;"><span class="gamepad-button-inner">'+(g.text||"&nbsp;")+'<span class="gamepad-button-inner-dec"></span></span></span>')}for(var i in e.axis_dual){var j=e.axis_dual[i],h=j.face||"front";a(".inpoot-gamepad-calibrate-face."+h).append('<span class="gamepad-button gamepadclass-'+i+" "+(j.style||"")+" "+(j.bclass||"")+' " style="left:'+j.x+"%; top:"+j.y+'%;"><span class="gamepad-button-inner">'+(j.text||"&nbsp;")+'<span class="gamepad-button-inner-dec"></span></span></span>')}a(".inpoot-gamepad-calibrate-layout").fadeIn();var l=a(".inpoot-gamepad-calibrate-gamepad-3d-holder");l.addClass("turned"),inpoot.utils.poll.setInterval(function(){l.hasClass("turned")?l.removeClass("turned"):l.addClass("turned")},4e3,"gpad-rotation"),k()},300,"gpad-buttons");var e=inpoot.gamepads[b.gpadType];a(".inpoot-gamepad-calibrate-panel-button.all").click(function(){g();var a=[],b=function(b,c,d,e){a.push({type:c,bid:b,style:d,text:e})};for(var c in e.button)b(c,"button");for(var d in e.axis_dual)b(d,"axis_dual","up","up"),b(d,"axis_dual","down","down"),b(d,"axis_dual","left","left"),b(d,"axis_dual","right","right");f(a)}),a(".inpoot-gamepad-calibrate-gamepad-3d-presskey .inpoot-x-out").click(function(){g(),k()});var l=function(b,c,d){var e=c.name?c.name:b,h=a('<div class="button-configure">'+e+"</div>");h.hover(function(){a(".gamepadclass-"+b).addClass("pressed")},function(){a(".gamepadclass-"+b).removeClass("pressed")}),h.click(function(){g(),d!="axis_dual"?f([{type:d,bid:b}]):f([{type:d,bid:b,style:"up",text:"up"},{type:d,bid:b,style:"down",text:"down"},{type:d,bid:b,style:"left",text:"left"},{type:d,bid:b,style:"right",text:"right"}])}),a(".inpoot-gamepad-calibrate-panel-inner-content").append(h)};for(var m in e.button)l(m,e.button[m],"button");for(var n in e.axis_dual)l(n,e.axis_dual[n],"axis_dual")};inpoot.utils.modal.show({template:"inpoot.gamepad-calibrate",data:b,behavior:l})},bd=function(){var b=[],c,d=function(b){var d=a(b.nodes[0]);c=d,d.find(".inpoot-top-option").click(function(){X()}),d.find(".inpoot-help").toggle(function(){a(".inpoot-main-gamepad-options-summary").stop(!0,!0).slideDown(function(){inpoot.utils.modal.expand()})},function(){a(".inpoot-main-gamepad-options-summary").stop(!0,!0).slideUp(function(){inpoot.utils.modal.expand()})})};inpoot.utils.modal.show({template:"inpoot.gamepad-content",data:{},behavior:d});var e=m.length,f=function(b){a(b.nodes[0]).click(function(){a(this).hasClass("active")&&bc(b.data)})},g=function(b){c.find(".inpoot-gamepad-list").html(""),a.tmpl("inpoot.gamepad-gamepad",{gamepads:b,gamepadPP:f}).appendTo(c.find(".inpoot-gamepad-list"))},h=function(){var c=[];m=G();var d=a.storage.getObject("storedGamepads")||[];for(var e=0;e<d.length;e++)c.push({id:d[e].id,displayName:d[e].displayName,gpadType:d[e].gpadType,active:!1});for(var e=0;e<m.length;e++){var f=!1;for(var h=0;h<c.length;h++)c[h].id==m[e].gamepad.id&&(c[h].active=!0,f=!0);f||(c.push({id:m[e].gamepad.id,displayName:m[e].gamepad.displayName,active:!0,gpadType:m[e].gamepad.gpadType}),d.push({id:m[e].gamepad.id,displayName:m[e].gamepad.displayName,gpadType:m[e].gamepad.gpadType}),a.storage.setObject("storedGamepads",d))}var i=!1;c.length!=b.length&&(i=!0);if(!i){var j=0;for(var e=0;e<c.length;e++)for(var h=0;h<b.length;h++)b[h].id==c[e].id&&b[h].active==c[e].active&&j++;j!=c.length&&(i=!0)}i&&(g(c),inpoot.utils.modal.expand()),b=c};g(),inpoot.utils.poll.setInterval(h,200)},be=function(){var b,c=function(b){a.storage.setObject("inpoot_stored_players",b)},d=function(a){var b=inpoot.gamepads["XBOX 360"].axis_dual,c=[];for(axis in b)b.hasOwnProperty(axis)&&c.push({axisName:axis,axisTitle:b[axis].name,axisType:"y"});return c},e=function(b,d,e){var f=a.storage.getObject("inpoot_stored_players")||[],g=-1;for(j=0;j<f.length;j++)f[j].number==b&&(g=j);g!=-1&&(f[g]=d,c(f),e&&e())},f=function(b){var c=a.storage.getObject("inpoot_action_mappings")||[];for(var d=0;d<c.length;d++)if(c[d].id===b)return c[d];return!1},g=function(b){var d=a.storage.getObject("inpoot_stored_players");for(var e in d)if(d[e].number==b.number){d[e]=b,c(d);return}},h=function(){var d=a.storage.getObject("inpoot_stored_players")||[];inpoot.players=[];for(var e=0;e<v;e++){var g=-1;for(j=0;j<d.length;j++)d[j].number==e+1&&(g=j);if(g!=-1){var h=f(d[g].actionMapId);h&&(d[g].title=h.name,d[g].gamepad=h.gamepad,d[g].keyboard=h.keyboard,d[g].mouse=h.mouse),inpoot.players.push(d[g])}else inpoot.players.push({number:e+1,title:!1,actionMapId:!1,keyboard:!1,mouse:!1,gamepad:!1,options:{},gamepadIndex:!1})}c(inpoot.players),a.tmpl("inpoot.player",inpoot.players,{rendered:k}).appendTo(b.find(".inpoot-players-list").html(""))},i=function(c){var d=a(c.nodes[0]);b=d,d.find(".inpoot-top-option").click(function(){X()}),h()},k=function(b){var c=a(b.nodes[0]);b.data.actionMapId===!1&&c.addClass("player-error"),c.find(".inpoot-player-actionmap").click(function(){var c=[],d=a.storage.getObject("inpoot_action_mappings");c.push({text:"[ NONE ]",value:!1,data:{name:!1,gamepad:!1,mouse:!0,keyboard:!0,id:!1}});for(var f=0;f<d.length;f++){var g=d[f].name;c.push({text:g,value:d[f].name,data:d[f]})}var i=a(".dumbBox-content"),j=inpoot.utils.optionBox({title:"Select action mapping for this player",container:i,options:c,callBack:function(a){b.data.title=a.data.name,b.data.actionMapId=a.data.id,b.data.gamepad=a.data.gamepad,b.data.keyboard=a.data.keyboard,b.data.mouse=a.data.mouse,e(b.data.number,b.data,h)}})});if(b.data.gamepad){var f=F();b.data.options.gpadIndex!==!1&&f[b.data.options.gpadIndex]&&f[b.data.options.gpadIndex].gpadType==b.data.gamepad?c.find(".inpoot-player-gamepad-index").html("Gamepad Slot "+(parseInt(b.data.options.gpadIndex)+1)):(b.data.options.gpadIndex=!1,g(b.data),c.find(".inpoot-player-gamepad-index").html("select gamepad"),b.data.options.gpadIndex!==!1,c.addClass("player-error"))}c.find(".inpoot-player-gamepad-index").click(function(){var d=[],e=!1;for(var h=0;h<4;h++)if(f[h]){var i=b.data.gamepad!=f[h].gpadType;i||(e=!0),d.push({value:h,text:"Gamepad Slot "+(h+1)+" : "+f[h].gpadType,disabled:i})}else d.push({value:h,text:"Gamepad Slot "+(h+1)+" : EMPTY",disabled:!0});var j=a(".dumbBox-content"),k=e?!1:"Could not detect gamepads of this type. Make sure your ("+b.data.gamepad+") gamepad is on and press buttons to activate it.",l=inpoot.utils.optionBox({title:k,container:j,options:d,callBack:function(a){b.data.options.gpadIndex=a.value,c.find(".inpoot-player-gamepad-index").html("Gamepad Slot "+(parseInt(b.data.options.gpadIndex)+1)),c.removeClass("player-error"),g(b.data)}})});var i=function(){a(this).html("close");var e=c.find(".inpoot-player-options");e.html("");var f=0;if(b.data.gamepad&&b.data.gamepad!="false"){var h=d(b.data.gamepad);for(var i=0;i<h.length;i++){var j=h[i].axisName;b.data.options.axes=b.data.options.axes||{},b.data.options.axes[j]=b.data.options.axes[j]===undefined?!1:b.data.options.axes[j],h[i].axisInverted=b.data.options.axes[j]}var k=function(c){var d=a(c.nodes[0]),e=c.data,f=c.data.axisName;d.click(function(){e.axisInverted?(e.axisInverted=!1,a(this).find(".inpoot-player-invert-axis-value").html("NORMAL"),a(this).removeClass("inverted-true").addClass("inverted-false")):(e.axisInverted=!0,a(this).find(".inpoot-player-invert-axis-value").html("INVERTED"),a(this).removeClass("inverted-false").addClass("inverted-true")),b.data.options.axes[f]=e.axisInverted,g(b.data)})};h.length>0&&(f++,a.tmpl("inpoot.player-options-title",{title:"Invert Gamepad Y Axes"}).appendTo(e),a.tmpl("inpoot.player-invert-axis",h,{rendered:k}).appendTo(e))}f==0&&a.tmpl("inpoot.player-options-title",{title:"No additional options for this player"}).appendTo(e),e.stop(!0,!0).show(0,inpoot.utils.modal.expand)},j=function(){a(this).html("options"),c.find(".inpoot-player-options").stop(!0,!0).hide(0,inpoot.utils.modal.expand)};c.find(".inpoot-player-options-button.options").toggle(i,j)};inpoot.utils.modal.show({template:"inpoot.player-content",data:{},behavior:i});var l=G().length,m=function(){var b=G();b.length!=l&&(l=b.length,h(),a(".inpoot-option-box-wrapper").remove(),a(".inpoot-option-box-screen").remove())};inpoot.utils.poll.setInterval(m,50,"player-gamepad-scanning")};inpoot.openMenu=function(){r=!0,X()},inpoot.utils={truncate:function(a,b){return a.length>b?a.substr(0,b-3)+"...":a},optionBox:function(b){var c={};c.container=b.container,c.options=b,c.close=function(){a(".inpoot-option-box-wrapper").remove(),a(".inpoot-option-box-screen").remove(),c.options.onClose&&c.options.onClose()},c.close();var d=a('<div class="inpoot-option-box-screen"></div>'),e=a('<span class="inpoot-option-box-wrapper"></span>'),f=a('<div class="inpoot-option-box"></div>'),g=a('<div class="inpoot-option-box-content"></div>'),h=a('<div class="inpoot-option-box-close">cancel</div>'),i=c.options.title?a('<div class="inpoot-option-box-title">'+c.options.title+"</div>"):a("<div></div>");e.append(f),f.append(h),f.append(i),f.append(g),c.options.maxHeight&&g.css("max-height",c.options.maxHeight+"px").css("overflow-y","auto"),h.click(function(){c.close()});var j=function(a){return function(b){b.preventDefault(),a.disabled||(c.close(),c.options.callBack.apply(c,[a]))}};for(var k=0;k<c.options.options.length;k++){var l=c.options.options[k].disabled?" disabled ":"",m=a('<div class="inpoot-option-box-option '+l+'"><a href="#">'+c.options.options[k].text+"</a></div>");m.click(j(c.options.options[k])),m.appendTo(g)}a(".dumbBoxWrap .vertical-offset").append(e),d.appendTo(a(".dumbBoxWrap .vertical-offset")),f.stop(!0,!0).fadeIn("fast")},styledSelect:function(b){var c={},d=b.callBack;c.container=b.container,c.options=b.options;var e={},f=a(".dumbBox-content"),g=c.options[0];for(var h=0;h<c.options.length;h++)c.options[h].value==b.selected&&(g=c.options[h]);var i=a('<span class="styled-select-container"></span>'),j=a('<span class="styled-select-value"></span>'),k=a('<span class="styled-select-options"></span>'),l=a('<span class="style-select-left-image"></span>'),m=a('<span class="style-select-right-image"></span>');return i.append(l),i.append(j),i.append(m),i.append(k),c.container.append(i),c.setValue=function(a){for(var b=0;b<c.options.length;b++)c.options[b].value==a&&(g=c.options[b]);j.html(inpoot.utils.truncate(g.text,25)),j.removeClass().addClass("styled-select-value"),g.style&&j.addClass(g.style)},c.getValue=function(){return g.value},c.container.click(function(){e=inpoot.utils.optionBox({title:undefined,container:f,options:c.options,callBack:function(a){var b=function(){g=a,d(a),i.removeClass("choosing"),i.find(".styled-select-value").removeClass().addClass("styled-select-value").addClass(a.style).html(inpoot.utils.truncate(a.text,25))},h;for(var j=0;j<c.options.length;j++)if(c.options[j].value==a.value){h=c.options[j];break}var k=a.ifNot&&a.ifNot.indexOf(g.value)!=-1;h.message&&a.value!=g.value&&!k?e=inpoot.utils.optionBox({title:h.message,container:f,options:[{text:"CANCEL",value:"cancel"},{text:"OK",value:"okay"}],callBack:function(a){a.value=="okay"&&b()}}):b()}})}),c.setValue(g.value),c},modal:{showing:!1,buttonPP:function(b){var c=a(b.nodes[0]);c.find("a").click(function(a){a.preventDefault(),that.hide(),b.data.click&&b.data.click(b.data)})},expand:function(){setTimeout(function(){var b=a(".dumbBox-content"),c=a(".dumbBox"),d=b.height(),e=b.width();c.css("height",d),c.css("width",e),setTimeout(function(){b.stop(!0,!0).fadeIn(200)},200)},50)},newContent:function(b,c){var d=this,e=b.behavior?b.behavior:a.noop,f=b.data?b.data:{},g=a(".dumbBox-content"),h=a(".dumbBox"),i=function(){g.stop(!0,!0).hide(),g.html(""),a.tmpl(b.template,f,{rendered:e}).appendTo(g),d.expand()};c?i():g.stop(!0,!0).fadeOut(500,i)},show:function(b){var c=this;inpoot.utils.poll.purge();if(!inpoot.utils.modal.showing){a.tmpl("inpoot.modal").appendTo(a("body"));var d=a(".dumbBoxWrap"),e=a(".dumbBoxOverlay"),f=a(".dumbBox"),g=a(".dumbBox-content"),h=a(".dumbBox-buttons");d.show(),e.stop(!0,!0).fadeIn(100,function(){f.stop(!0,!0).fadeIn(200,function(){c.newContent(b,!0),inpoot.utils.modal.showing=!0})}),a(".vertical-offset").click(function(b){a(b.target).hasClass("vertical-offset")&&c.hide()}),e.click(c.hide)}else c.newContent(b,!0)},hide:function(){var b=this;inpoot.utils.poll.purge(),inpoot.utils.modal.showing=!1;var c=a(".dumbBoxWrap"),d=a(".dumbBoxOverlay"),e=a(".dumbBox"),f=a(".dumbBox-content"),g=a(".dumbBox-buttons");e.stop(!0,!0).hide(),d.stop(!0,!0).fadeOut(200,function(){f.html(""),g.html(""),a(".dumbBoxWrap").remove()}),r=!1,inpoot.refreshParams()}},poll:{pollId:0,repository:{},getPollId:function(){return this.pollId++,"poll-"+this.pollId},clear:function(a){var b=this.repository[a];b&&(b.type=="timeout"?clearTimeout(b.pollObj):clearInterval(b.pollObj),delete this.repository[a])},purge:function(){for(poll in this.repository){var a=this.repository[poll];a.type=="timeout"?clearTimeout(a.pollObj):clearInterval(a.pollObj),delete this.repository[poll]}},setTimeout:function(a,b,c){var c=c||this.getPollId(),d={type:"timeout",pollObj:setTimeout(a,b)};this.repository[c]=d},setInterval:function(a,b,c){var c=c||this.getPollId(),d={type:"interval",pollObj:setInterval(a,b)};this.repository[c]=d}}},a.template("inpoot.main-content",['<div class="inpoot-main-wrapper">','<div class="inpoot-main-menu">','<div class="inpoot-main-option players">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon players"></span></span>','<span class="inpoot-main-options-title">Players</span>',"</div>",'<div class="inpoot-main-option mappings">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon gamepad"></span></span>','<span class="inpoot-main-options-title">Mappings</span>',"</div>",'<div class="inpoot-main-option settings">','<span class="inpoot-main-options-image"><span class="inpoot-input-icon settings"></span></span>','<span class="inpoot-main-options-title">calibrate</span>',"</div>","</div>","</div>"].join("")),a.template("inpoot.action_map",['<div class="inpoot-edit-action-map-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">',"Edit Action Map","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-main-gamepad-options-message inpoot-no-select">','<div class="inpoot-options-left">','<input type="text" value="${actionMap.name}" id="inpoot-action-edit-name" size="16"/>',"</div>",'<div class="inpoot-options-right">','<div class="inpoot-input-selector keyboard">',"</div>",'<div class="inpoot-input-selector mouse">',"</div>",'<div class="inpoot-input-selector gamepad">',"</div>","</div>",'<div class="inpoot-options-clear"></div>',"</div>",'<div class="inpoot-map-form">','<div class="inpoot-map-form-left"><div class="inpoot-map-form-left-inner"></div></div>','<div class="inpoot-map-form-middle"><div class="inpoot-map-form-middle-inner"></div></div>','<div class="inpoot-map-form-left-hidden"><div class="inpoot-map-form-left-hidden-inner">','<div class="inpoot-editing-inputs-title"></div>','<div class="inpoot-editing-inputs-close"><div class="inpoot-close-edit-mapping">CLOSE</div></div>',"</div></div>",'<div class="inpoot-map-form-right"><div class="inpoot-map-form-right-inner"></div></div>',"</div>","</div>"].join("")),a.template("inpoot.action_map.action_list",['<div class="inpoot-edit-action-map-list-group">','<div class="inpoot-edit-action-map-list-group-name">${name}<span class="inpoot-selected-arrow"></span></div>',"</div>"].join("")),a.template("inpoot.action_map.action_list_item",['<div class="inpoot-edit-action-map-list-group-action">{{if (actionId != descr && descr != undefined) }} ${inpoot.utils.truncate(descr, 22)} {{else}} ${inpoot.utils.truncate(actionId, 22)} {{/if}}<span class="inpoot-selected-arrow"></span></div>'].join("")),a.template("inpoot.action_map.action_list_mappings",['<div class="inpoot-edit-action-map-list-mappings">',"list-of-mappings","</div>"].join("")),a.template("inpoot.action_map.action_edit_mapping",['<div class="inpoot-edit-action-map-edit_mapping input-count-${inputCount}">','{{if (actionMap.keyboard && actionMap.keyboard != "false")}}','<div class="inpoot-edit-mapping-gather-inputs keyboard">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>KEYBOARD  <span class="inpoot-gather-add-button">PRESS KEYS</span></div>','<div class="inpoot-edit-mapping-gather-input-list">',"</div>","</div>","{{/if}}",'{{if (actionMap.gamepad && actionMap.gamepad != "false")}}','<div class="inpoot-edit-mapping-gather-inputs gamepad">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>GAMEPAD <span class="inpoot-gather-add-button active">CLICK -or- PRESS BUTTONS</span></div>','<div class="inpoot-edit-mapping-gather-input-list"></div>',"</div>","{{/if}}",'{{if (actionMap.mouse && actionMap.mouse != "false")}}','<div class="inpoot-edit-mapping-gather-inputs mouse">','<div class="inpoot-edit-mapping-gather-title inpoot-input-icon-xsmall-container"><span class="inpoot-input-icon-xsmall"></span>MOUSE <span class="inpoot-gather-add-button active">CLICK to add mouse input</span></div>','<div class="inpoot-edit-mapping-gather-input-list"></div>',"</div>","{{/if}}","</div>"].join("")),a.template("inpoot.action_map.action_edit_action_map_item",['<div class="inpoot-edit-mapping-gather-input-list-item"><span class="inpoot-x-out"></span>${name}</div>'].join("")),a.template("inpoot.action_map.action_edit_action_inputs",["<div>",'<div class="inpoot-edit-action-top"><span class="inpoot-edit-action-title">${descr}</span> {{if actionId != descr}}<span class="inpoot-edit-action-title-actionid"> : ${actionId} </span>{{/if}}</div>','<div class="inpoot-main-gamepad-edit-action-options"> [+] New Input Combination </div>','<div class="inpoot-main-gamepad-edit-action-options-list"></div>',"</div>"].join("")),a.template("inpoot.action_map.action_edit_action_input",['<div class="inpoot-edit-action-keys">','<div class="inpoot-x-out"></div>','<div class="inpoot-edit-action-keys-list">',"{{if inputs.length == 0}}",'<span class="inpoot-edit-action-keys-list-and edit">(click to edit)</span> ',"{{else}}",'{{tmpl(inputs) "inpoot.action_map.action_edit_action_input_listing"}}',"{{/if}}","</div>","</div>"].join("")),a.template("inpoot.action_map.action_edit_action_input_listing",['<span class="inpoot-input-item ${type}"><span class="inpoot-input-icon-xsmall-container"><span class="inpoot-input-listing-title-type inpoot-input-icon-xsmall">&nbsp;</span><span class="inpoot-input-listing-title">${text}</span></span></span>'].join("")),a.template("inpoot.action_map.action_edit_action_input_hidden",['<div class="inpoot-edit-action-keys hide-action-inputs">','<div class="inpoot-x-out"></div>','<div class="inpoot-edit-action-keys-list">{{if inputs.length == 0}} <span class="inpoot-edit-action-keys-list-and edit">(click to edit)</span> {{else}} yo {{/if}}</div>',"</div>"].join("")),a.template("inpoot.mappings",['<div class="inpoot-mappings-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">',"view and edit stored input to action maps","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-main-gamepad-options-message">','<span class="inpoot-message-button">[+] Create New Mapping</span>',"</div>",'<div class="inpoot-mappings-list"></div>',"</div>"].join("")),a.template("inpoot.mapping-list",['<div class="inpoot-mapping-item">','<span class="inpoot-mapping-item-left">','<span class="inpoot-mapping-item-delete">&nbsp;</span>','<span class="inpoot-mapping-item-name">${name} <span class="inpoot-parens">{{if extra}}(${extra}){{/if}}</span></span>',"</span>",'<span class="inpoot-mapping-item-delete-confirm">','<span class="inpoot-mapping-item-delete-confirm-okay inpoot-mapping-item-delete-confirm-button">Delete</span>','<span class="inpoot-mapping-item-delete-confirm-cancel inpoot-mapping-item-delete-confirm-button">Cancel</span>',"</span>",'<span class="inpoot-mapping-item-inputs">','{{if keyboard && keyboard != "false"}}','<span class="inpoot-mapping-item-inputs-input keyboard">&nbsp;</span>',"{{/if}}",'{{if gamepad && gamepad != "false"}}','<span class="inpoot-mapping-item-inputs-input gamepad">&nbsp;</span>',"{{/if}}",'{{if mouse && mouse != "false"}}','<span class="inpoot-mapping-item-inputs-input mouse">&nbsp;</span>',"{{/if}}","</span>","</div>"].join("")),a.template("inpoot.gamepad-calibrate",['<div class="inpoot-gamepad-calibrate-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">','press buttons to verify the <span class="inpoot-top-highlight">${gpadType}</span> gamepad\'s configuration',"</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-gamepad-calibrate-content">','<div class="inpoot-gamepad-calibrate-layout" style="display:none;">','<div class="inpoot-gamepad-calibrate-gamepad-3d-holder">','<div class="inpoot-gamepad-calibrate-face top"></div>','<div class="inpoot-gamepad-calibrate-face bottom"></div>','<div class="inpoot-gamepad-calibrate-face left"></div>','<div class="inpoot-gamepad-calibrate-face right"></div>','<div class="inpoot-gamepad-calibrate-face front"></div>','<div class="inpoot-gamepad-calibrate-face back"></div>',"</div>",'<div class="inpoot-gamepad-calibrate-gamepad-3d-presskey">','<div class="inpoot-gamepad-calibrate-gamepad-3d-presskey-text"></div>','<div class="inpoot-x-out"></div>',"</div>","</div>",'<div class="inpoot-gamepad-calibrate-panel">','<div class="inpoot-gamepad-calibrate-panel-inner">','<div class="inpoot-gamepad-calibrate-panel-button all">Click to configure all buttons</div>','<div class="inpoot-gamepad-calibrate-panel-inner-content">',"</div>","</div>","</div>","</div>","</div>"].join("")),a.template("inpoot.gamepad-content",['<div class="inpoot-gamepad-wrapper">','<div class="inpoot-top with-icon">','<span class="inpoot-help"></span>','<span class="inpoot-top-title">',"calibrate different gamepad types","</span>",'<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-gamepad-list"></div>',"</div>"].join("")),a.template("inpoot.gamepad-gamepad",['<div class="inpoot-main-gamepad-options-summary">',"Verify that your gamepads' buttons are configured correctly. </br>Not right? Click and edit each type of gamepads' configurations.","</div>",'<div class="inpoot-main-gamepad-options-message">',"Hold down keys on your gamepad to load / calibrate gamepads","</div>","{{if gamepads}}",'{{tmpl(gamepads, {rendered:gamepadPP}) "inpoot.gamepad-gamepad-indy"}}',"{{/if}}"].join("")),a.template("inpoot.gamepad-gamepad-indy",['<div class="inpoot-main-gamepad-option {{if active}}active{{/if}}">','<span class="inpoot-gamepad-option-left">','<span class="inpoot-input-icon gamepad"></span>',"</span>",'<span class="inpoot-gamepad-option-right">',"${displayName}","</br>",'<span class="inpoot-gamepad-option-subinfo">',"{{if active}}","Click to calibrate this type of gamepad","{{else}}","To calibrate, ensure your gamepad is on. Hit keys to activate it.","{{/if}}","</span>","</span>",'<span class="inpoot-status-bar"></span>',"</div>"].join("")),a.template("inpoot.player-content",['<div class="inpoot-player-wrapper">','<div class="inpoot-top">','<span class="inpoot-top-title">edit player mappings and options</span>','<span class="inpoot-top-options">','<span class="inpoot-top-option">back</span>',"</span>","</div>",'<div class="inpoot-players-list">',"</div>","</div>"].join("")),a.template("inpoot.player",['<div class="inpoot-player inpoot-no-select">','<div class="inpoot-player-info">','<div class="inpoot-player-left">','<div class="inpoot-player-title">','<span class="inpoot-player-icon  inpoot-mapping-item-inputs-input players"></span>','<span class="inpoot-player-number">Player ${number}</span>',"</div>","</div>",'<div class="inpoot-player-right">','<span class="inpoot-player-options-button options inpoot-gather-add-button active">',"options","</span>",'<span class="inpoot-player-actionmap inpoot-gather-add-button active">',"{{if title}}",'<span class="inpoot-player-actionmap-title">${title}</span>','<span class="inpoot-player-input-types">','{{if keyboard && keyboard != "false"}}','<span class="keyboard"><span class="inpoot-input-icon-xsmall"></span></span>',"{{/if}}",'{{if mouse && mouse != "false"}}','<span class="mouse"><span class="inpoot-input-icon-xsmall"></span></span>',"{{/if}}",'{{if gamepad && gamepad != "false"}}','<span class="gamepad"><span class="inpoot-input-icon-xsmall"></span></span>',"{{/if}}","</span>","{{else}}","( click to set action mapping )","{{/if}}","</span>",'{{if gamepad && gamepad != "false"}}','<span class="inpoot-player-options-button inpoot-gather-add-button active inpoot-player-gamepad-index">gpad</span>',"{{/if}}","</div>","</div>",'<div class="inpoot-player-options"></div>',"</div>"].join("")),a.template("inpoot.player-invert-axis",['<span class="inpoot-player-invert-axis inverted-${axisInverted}">','<span class="inpoot-player-invert-axis-name">${axisTitle}</span>','<span class="inpoot-player-invert-axis-value">',"{{if axisInverted}}","INVERTED","{{else}}","NORMAL","{{/if}}","</span>","</span>"].join("")),a.template("inpoot.player-options-title",['<div class="inpoot-player-options-title">${title}</div>'].join("")),a.template("inpoot.modal",['<div class="dumbBoxWrap">','<div class="dumbBoxOverlay">',"&nbsp;","</div>",'<div class="vertical-offset">','<div class="dumbBox">','<div class="dumbBox-content-wrapper">','<div class="dumbBox-content"></div>',"</div>","</div>","</div>","</div>"].join("")),a.template("inpoot.modal.buttons",['<span class="dumbBox-button">','<a href="#">${title}</a>',"</span>"].join(""))})(jQuery),function(a){a.storage=window.localStorage,Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))},Storage.prototype.getObject=function(a){var b=this.getItem(a);return b&&JSON.parse(b)},Storage.prototype.removeObject=function(a){var b=this.removeItem(a);return b&&JSON.parse(b)}}(jQuery),function(a){var b={init:function(b){var c=a(this[0]),d={onChange:a.noop,defaultText:""},e=a.extend({},d,b);return c.data("plugin-options",e),c.focus(function(){a(this).val()==e.defaultText&&a(this).val("")}),c.keyup(function(b){(b.which==13||b.which==27)&&a(this).blur()}),c.blur(function(){a.trim(a(this).val())==""&&a(this).val(e.defaultText),e.onChange(a(this).val())}),c}};a.fn.inpootEdit=function(a){if(this.length==0)return;return b[a]?b[a].apply(this,Array.prototype.slice.call(arguments,1)):b.init.apply(this,arguments)}}(jQuery),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(this==null)throw new TypeError;var b=Object(this),c=b.length>>>0;if(c===0)return-1;var d=0;arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:d!=0&&d!=Infinity&&d!=-Infinity&&(d=(d>0||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;var e=d>=0?d:Math.max(c-Math.abs(d),0);for(;e<c;e++)if(e in b&&b[e]===a)return e;return-1});var inpoot=inpoot||{};(function(){inpoot.gamepads={},inpoot.gamepads["XBOX 360"]={displayName:"XBOX 360 Controller",idMatches:[["45e","28e"],["45e","2a1"],["XInput","GAMEPAD"]],button:{dpadUp:{name:"dpad up",style:"dpadUp",x:30,y:45},dpadDown:{name:"dpad down",style:"dpadDown",x:30,y:65},dpadLeft:{name:"dpad left",style:"dpadLeft",x:25,y:55},dpadRight:{name:"dpad right",style:"dpadRight",x:35,y:55},start:{style:"round_small",text:"s",bclass:"xbox-white",x:60,y:20},back:{style:"round_small",text:"b",bclass:"xbox-white",x:40,y:20},on:{style:"round_large",text:"ON",bclass:"xbox-center",x:50,y:20},A:{style:"round",text:"A",bclass:"xbox-a",x:80,y:30},B:{style:"round",text:"B",bclass:"xbox-b",x:86,y:20},X:{style:"round",text:"X",bclass:"xbox-x",x:74,y:20},Y:{style:"round",text:"Y",bclass:"xbox-y",x:80,y:10},lBumper:{name:"left bumper",style:"bumper",text:"LB",face:"top",x:25,y:70},rBumper:{name:"right bumper",style:"bumper",text:"RB",face:"top",x:75,y:70},lStickClick:{name:"left stick click",style:"stick_click",target:"lStick",x:20,y:20},rStickClick:{name:"right stick click",style:"stick_click",target:"rStick",x:70,y:55},lTrigger:{name:"left trigger",style:"trigger",text:"LT",face:"top",x:25,y:20},rTrigger:{name:"right trigger",style:"trigger",text:"RT",face:"top",x:75,y:20}},axis_dual:{lStick:{name:"left stick",style:"axis",x:20,y:20},rStick:{name:"right stick",style:"axis",x:70,y:55}}},inpoot.gamepads["Playstation 3"]={displayName:"Playstation 3 Controller",idMatches:[["54c","268"]],button:{dpadUp:{style:"dpadUp",x:20,y:12},dpadDown:{style:"dpadDown",x:20,y:28},dpadLeft:{style:"dpadLeft",x:15,y:20},dpadRight:{style:"dpadRight",x:25,y:20},start:{style:"round_small",text:"st",bclass:"ps-mid",x:60,y:20},back:{style:"round_small",text:"sl",bclass:"ps-mid",x:40,y:20},on:{style:"round",text:"ON",bclass:"",x:50,y:32},X:{style:"round",text:"X",bclass:"ps-x",x:80,y:30},SQUARE:{style:"round",text:"[]",bclass:"ps-square",x:74,y:20},CIRCLE:{style:"round",text:"O",bclass:"ps-circle",x:86,y:20},TRIANGLE:{style:"round",text:"^",bclass:"ps-triangle",x:80,y:10},lBumper:{style:"bumper",text:"L1",bclass:"ps-bumper",face:"top",x:25,y:70},rBumper:{style:"bumper",text:"R1",bclass:"ps-bumper",face:"top",x:75,y:70},lStickClick:{style:"stick_click",target:"lStick",x:30,y:45},rStickClick:{style:"stick_click",target:"rStick",x:70,y:45},lTrigger:{style:"trigger",text:"L2",bclass:"ps-trigger",face:"top",x:25,y:20},rTrigger:{style:"trigger",text:"R2",bclass:"ps-trigger",face:"top",x:75,y:20}},axis_dual:{lStick:{style:"axis",x:30,y:45},rStick:{style:"axis",x:70,y:45}}},inpoot.gamepads["Logitech F310"]={displayName:"Logitech F310 Controller",idMatches:[["46d","c21d"],["46d","c21e"],["46d","c216"]],button:{}}})(jQuery);var inpoot=inpoot||{};(function(){inpoot.keyboards={},inpoot.currentKeyboard="wasd",inpoot.setCurrentKeyboard=function(a){inpoot.currentKeyboard=a},inpoot.getKeyboardMap=function(a){return inpoot.keyboards[inpoot.currentKeyboard][a]},inpoot.keyboards.wasd={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause/Break",20:"Caps Lock",27:"Esc",32:"Spacebar",33:"Page Up",34:"Page Down",35:"End",36:"Home",37:"Arrow Left",38:"Arrow Up",39:"Arrow Right",40:"Arrow Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",189:"_-",187:"=+",186:";:",59:";:",61:"=+",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"Windows",96:"0 (Num Lock)",97:"1 (Num Lock)",98:"2 (Num Lock)",99:"3 (Num Lock)",100:"4 (Num Lock)",101:"5 (Num Lock)",102:"6 (Num Lock)",103:"7 (Num Lock)",104:"8 (Num Lock)",105:"9 (Num Lock)",106:"* (Num Lock)",107:"+ (Num Lock)",109:"- (Num Lock)",110:". (Num Lock)",111:"/ (Num Lock)",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",124:"F12",144:"Num Lock",145:"Scroll Lock",182:"My Computer",183:"My Calculator",188:",<",190:".>",191:"/?",192:"`~",220:"|",221:"]}",222:"'\"",219:"[{"}})(jQuery);